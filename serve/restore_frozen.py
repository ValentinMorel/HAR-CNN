import tensorflow as tf
from sklearn.preprocessing import normalize
import argparse 
import tensorflow as tf
import numpy as np
import pandas as pd


def load_graph(frozen_graph_filename):
    with tf.gfile.GFile(frozen_graph_filename, "rb") as f:
        graph_def = tf.GraphDef()
        graph_def.ParseFromString(f.read())

    with tf.Graph().as_default() as graph:
        tf.import_graph_def(graph_def, name="prefix")
    return graph


def norm(x):
    temp = x.T - np.mean(x.T, axis = 0)
    return temp.T

segment_size = 128
num_channels = 3
if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument("--frozen_model_filename", default="frozen_model.pb", type=str, help="Frozen model file to import")
    args = parser.parse_args()
    graph = load_graph(args.frozen_model_filename)

    #for op in graph.get_operations():
        #print(op.name)

    x = graph.get_tensor_by_name('prefix/input_x:0')
    y_conv = graph.get_tensor_by_name('prefix/prediction_opt:0')
    keep_prob = graph.get_tensor_by_name('prefix/keep_prob_opt:0')
    
    test =[[2.36072745,-1.40207463,10.17500459
,1.968649218,-1.124484199,12.87299592
,2.219143644,-1.004179853,11.367157
,1.855789092,-0.875306275,13.05012528
,1.961468298,-0.809469207,11.95323975
,2.131895466,-0.820252555,9.823977288
,1.737064548,-0.550525232,9.355900986
,0.983211566,-0.26702251,10.22670722
,0.420442866,0.01571305,10.75390643
,0.491270674,-0.024593454,9.98686449
,0.651548808,-0.106171099,10.08081486
,0.727235705,-0.14687375,10.13084194
,0.807195249,-0.091595028,10.40060516
,0.729485726,-0.083097606,10.01582753
,0.493664314,-0.224164386,10.02923192
,0.455090805,-0.342350361,9.91026801
,0.222022078,-0.328910072,9.832714074
,-0.053703707,-0.100906288,10.10307571
,0.066112337,-0.52673245,10.75127342
,0.176351427,-0.791397225,10.89872165
,0.588488362,-2.21232177,12.73296798
,1.915031682,-2.229555978,10.1370654
,2.394717138,-2.015923608,8.763235722
,2.414344986,-2.037945096,9.545118228
,1.910005038,-1.653646194,9.846597186
,0.755696084,-1.356954516,9.71757999
,0.836266007,-1.385199468,9.109715112
,0.561320548,-1.362818934,9.141071796
,0.460991128,-1.40506668,9.243878634
,0.385531627,-1.495067544,9.190500462
,0.509067387,-1.651491918,9.000445446
,0.653762925,-1.769019642,8.782025796
,0.822418799,-1.938609036,8.546970348
,0.829707433,-2.028968946,8.912838222
,0.853021487,-2.11358412,8.875138392
,0.837809905,-2.255526972,9.475463304
,0.716548102,-2.374371198,10.51657702
,0.859029523,-2.514159774,10.21306347
,0.806010397,-2.548747872,11.40964411
,0.927344009,-2.55162024,10.9655042
,0.519994354,-2.424637638,13.56356106
,0.633740126,-2.096708958,12.8598309
,0.834901632,-1.94961978,12.55942908
,0.826859002,-1.496743092,11.97657774
,1.157169353,-1.195982226,9.664201818
,0.866222411,-0.601689287,9.779096538
,0.697243396,-0.077873487,8.707822956
,0.363330616,0.448927182,9.275355
,-0.100927831,1.116836519,9.58772502
,-0.099413853,1.639882764,9.553376286
,0.496632427,1.677462912,10.31539158
,0.983630453,1.705827546,10.72985035
,1.112097112,1.703792952,10.85503772
,1.29077037,1.701159948,10.75989053
,1.359707202,1.398244806,10.21904757
,1.415718378,1.160771782,10.1776376
,1.375385544,0.855187731,9.834389622
,1.22973255,0.517899919,9.499519386
,1.037487353,0.336533816,9.294384438
,0.75865223,0.126467969,8.883276768
,0.609336967,-0.025777109,8.84509821
,0.476860961,-0.150093196,8.835882696
,0.543176757,-0.512777529,9.076204152
,0.465347552,-0.66257152,9.68945472
,0.132607656,-0.703036004,8.917027092
,0.185351513,-0.910983479,9.260873478
,-0.023190781,-1.014855487,9.384983712
,0.330310352,-1.065289482,9.014208876
,0.378781562,-1.226620818,10.27517843
,0.415045208,-1.456170894,11.67641528
,0.721311446,-1.494110088,11.38762262
,0.655977042,-1.776200562,12.12498342
,-0.143989414,-1.685242242,14.3379036
,0.293232868,-1.616544774,12.06035514
,-0.525248393,-1.716000516,14.69335914
,0.130800458,-1.748075292,11.86706871
,0.83657718,-1.841546934,9.267455988
,1.176821138,-1.96458003,8.7906429
,1.240623612,-2.195207244,8.835643332
,1.537075926,-2.471552982,8.266675104
,1.725694758,-2.967036462,8.581917492
,2.169355932,-3.32356914,8.057470968
,2.20155039,-3.421588698,8.005768344
,1.969008264,-3.329672922,8.466065316
,1.86045669,-3.0219705,8.846773758
,1.648380186,-2.781649044,9.42196545
,1.611757494,-2.545995186,9.992968272
,0.99947635,-2.011136328,9.612499194
,-0.37353949,-1.333137798,8.660907612
,-0.580948396,-1.50619797,8.66737044
,-0.454300904,-1.626119334,8.785616256
,-0.345079111,-1.869552522,9.402457284
,-0.342003283,-2.096469594,10.29181423
,-0.28185111,-2.245473684,10.67108648
,-0.356173632,-2.325660624,11.51292967
,-0.324182633,-2.252774286,10.82763054
,-0.410856338,-2.329969176,12.23389404
,-0.704998789,-2.25959616,13.74906816
,-0.437162441,-2.242601316,12.63961602
,-0.656395929,-1.910962494,14.25651984
,-0.239507618,-1.519841718,11.45201153
,-0.068355178,-1.082236453,9.750013812
,0.235582049,-0.755444752,8.347340772
,0.229238903,-0.408654189,8.58179781
,0.030096433,-0.046036878,8.931987342
,-0.209491373,0.336749243,9.317004336
,-0.373443745,0.61828918,9.944856108
,-0.220765417,0.715518837,9.598735764
,-0.31609213,0.740975198,9.857966976
,-0.108494127,0.664929256,9.813684636
,0.157489544,0.595106777,9.485875638
,0.301119912,0.385986418,9.742354164
,0.627337139,0.125989241,9.785679048
,0.720318085,-0.071588985,9.784123182
,0.737121438,-0.265251217,9.535543668
,0.687608995,-0.456981781,9.240766902
,0.556473427,-0.493736123,9.084701574
,0.509785479,-0.5206167,8.908649352
,0.451476409,-0.486878344,9.051429978
,0.402323011,-0.457484445,9.236937078
,0.405638203,-0.409970691,9.00786573
,0.354462179,-0.38550769,8.877172986
,0.22679739,-0.398373505,9.29869299
,0.215511377,-0.348298556,9.568934946
,0.118758055,-0.458202537,10.26309055
,0.053634292,-0.695723434,11.36751604
,0.251786992,-0.983331248,11.70681451
,0.475233286,-1.050365137,11.30049412
,0.597249085,-1.191553992,11.48755709
,0.172234366,-1.266953652,14.05306044
,0.550597041,-1.324041966,11.90620472
,0.470529783,-1.589736006,13.3983999
,0.90146876,-1.738620414,11.56068279
,1.525825818,-1.948303278,9.448175808
,1.280956446,-2.124594864,9.52130151
,1.093821671,-2.371738194,9.520344054
,1.511942706,-2.80594449,8.28259281
,2.021069934,-3.329912286,7.736483844
,2.349836388,-3.613558626,7.772508126
,2.60966601,-3.764716992,7.559354484
,2.731023558,-3.58507431,8.315146314
,3.030707286,-3.383170776,8.313351084
,3.203647776,-3.039563754,8.595680922
,3.14524296,-2.658256902,9.187867458
,2.96452314,-2.294184258,9.329929992
,2.606793642,-1.974633318,9.462417966
,2.284609698,-1.748194974,9.42914637
,2.025258804,-1.61451018,9.269610264
,1.808514702,-1.527262002,9.146577168
,1.684404468,-1.49303295,8.968610034
,1.591650918,-1.481543478,8.886627864
,1.598592474,-1.471370508,8.947785366
,1.701758358,-1.427925942,8.473365918
,1.77608088,-1.403151768,8.192591946
,1.769139324,-1.374787134,8.280318852
,1.635095484,-1.373231268,9.399584916
,1.694577438,-1.325956878,10.18206583
,1.792357632,-1.33744635,10.59113891
,1.855310364,-1.185390369,10.67443758
,1.941720768,-1.243136934,11.2334722
,1.826586684,-1.031634904,13.7873664
,2.344450698,-1.08704767,12.16328166
,2.218545234,-0.983929658,14.3917605
,2.473707258,-0.840813923,11.9981205
,2.600330814,-0.498930322,10.03653252
,2.521819422,-0.047404843,8.557382682
,2.06810496,0.438574689,9.145739394
,1.569749112,1.026081659,9.121922676
,1.204120602,1.445997924,9.122999814
,0.986107871,1.78565544,9.40820202
,1.151723822,1.897797474,9.078238746
,1.43678241,1.85447259,9.453920544
,1.739338506,1.79941887,9.776104488
,2.11777299,1.754179074,9.621595026
,2.525170518,1.656638244,9.76724802
,2.691528498,1.49363136,10.15717198
,2.783324592,1.270544112,10.11791628
,2.79696834,1.014053618,9.945334836
,2.680039026,0.731101433,9.774548622
,2.491420194,0.495375766,9.503827938
,2.312375922,0.328814327,9.270328356
,2.04775902,0.248100786,9.1197684
,1.929154158,0.258560993,9.014807286
,1.866680154,0.260164732,8.55666459
,1.856028456,0.309234352,8.194267494
,2.047040928,0.342206743,8.315744724
,2.189103462,0.346682849,8.736426954
,2.2859262,0.322949909,9.776702898
,2.23925022,0.366849266,10.3358572
,2.288798568,0.369805412,10.98237937
,2.82868407,0.28317958,10.71381296
,3.013832124,0.007558158,12.08309472
,3.118194828,0.033880777,12.68868564
,3.337811298,-0.204345047,12.49360398
,3.226985766,-0.092797832,13.00225248
,3.684051324,-0.354905003,9.285288606
,3.451509198,-0.419234078,9.08625744
,3.132556668,-0.626176224,8.552116674
,2.760824376,-0.898141601,8.214733116
,2.711515392,-1.24409439,8.16590286
,3.060029376,-1.80420615,7.856165844
,3.539954196,-2.132972604,7.677839664
,4.030411032,-2.420927496,7.640379198
,4.543966494,-2.549585646,8.189001486
,5.209996824,-2.604160638,8.740256778
,5.805295092,-2.54623455,8.95281201
,5.790095478,-2.346844338,9.198040428
,5.630559372,-2.070737964,9.297855216
,5.059795914,-1.79523,9.58293774
,4.535229708,-1.522115676,9.478934082
,4.082113656,-1.34343045,9.057892806
,3.678306588,-1.166803754,8.65779588
,3.518531118,-1.085539676,8.085955284
,3.464554536,-1.009613416,8.217485802
,3.575140704,-0.9637034,7.9887735
,3.756339252,-0.931353356,7.908825924
,3.85794927,-0.848389793,7.519261014
,3.736711404,-0.669800313,7.661562912
,4.03866909,-0.711689013,8.369122896
,4.601653218,-0.776640434,8.70028299
,4.91115087,-0.831047872,9.087095214
,5.014436436,-0.690517267,9.189423324
,5.030114778,-0.720270212,9.414545166
,4.766215968,-0.502221577,11.492105
,4.806788166,-0.334989918,11.24831277
,4.599857988,-0.284723478,13.1949405
,4.831322976,-0.19208961,12.03522192
,4.827014424,-0.203208068,10.6670173
,4.409922654,0.081133625,10.4974279
,3.972963672,0.235498271,8.881242174
,3.24158697,0.584574761,8.531292006
,2.504226168,0.91437048,8.44117146
,1.902225708,1.259892414,8.815417074
,1.759205718,1.447194744,8.738700912
,1.72880649,1.651252554,8.807039334
,1.85566941,1.666212804,8.425852164
,2.344809744,1.762676496,8.616864636
,2.778896358,1.796067774,8.640322308
,3.490645212,1.800376326,8.563725828
,4.010783184,1.68213051,8.821042128
,4.214721312,1.596797244,9.603163998
,4.182766218,1.51816617,9.997157142
,4.175345934,1.532049282,10.22586944
,4.190545548,1.543538754,10.22395453
,4.199282334,1.538631792,10.00350029
,4.1230449,1.556823456,9.448056126
,4.046328738,1.496384046,8.878250124
,3.852443898,1.471729554,8.347101408
,3.94172667,1.502966556,8.706027726
,4.400826822,1.379694096,8.254108494
,4.824501102,1.258695594,7.958134908
,5.023532268,1.090805684,8.182538658
,5.046630894,1.190045999,7.929411228
,5.211193644,1.144722425,7.836537996
,5.30909352,1.247924214,8.237353014
,5.273667648,1.276887258,11.1470618
,5.117841684,1.356356106,11.12025303
,5.002348554,1.322845146,11.4522509
,4.934249496,1.400997492,12.37033152
,5.066617788,1.153112134,11.19457555
,5.018744988,1.006884666,10.412334
,4.952321478,0.544565068,8.106420906
,4.708409562,0.055291887,7.621469442
,4.22058573,-0.472564377,7.44481881
,3.756578616,-0.987185009,7.779449682
,3.749397696,-1.357552926,8.328311334
,3.63175029,-1.510506522,8.03185902
,4.305799314,-1.780150068,8.246927574
,4.65862185,-1.959673068,9.050711886
,4.997800638,-2.032439724,9.337469958
,5.328003276,-1.966255578,9.428667642
,5.33602197,-1.819405764,9.248665914
,5.086365318,-1.619417142,8.906016348
,4.78847682,-1.406024136,8.687836062
,4.477542984,-1.203881238,8.37235431
,4.352116248,-1.023927383,8.08152705
,3.949745364,-0.800828167,7.462053018
,4.121369352,-0.957659459,8.268470334
,4.49705115,-0.980506753,7.655578812
,4.659100578,-1.036075106,7.854011568
,4.963930632,-0.96643215,9.200793114
,4.86686853,-1.105191461,10.17057636
,4.810857354,-1.012078865,11.18488131
,5.104796346,-1.1338553,9.469598886
,5.315795712,-1.206873288,9.362962224
,5.472220086,-0.969352391,8.668806624
,5.120355006,-0.780183022,8.478631926
,4.529125926,-0.505859909,8.479110654
,3.81486375,-0.19195796,8.637569622
,3.252597714,-0.024445049,8.988477246
,3.240150786,0.006996131,9.581501556
,3.13327476,0.209551214,8.041672944
,3.48992712,0.224511464,8.432314992
,3.420631242,0.312417893,9.417656898
,3.421469016,0.404585001,10.02612019
,3.349540134,0.470745211,10.5187313
,3.223514988,0.526983782,10.61459658
,3.026518416,0.505955655,10.21497838
,2.94058674,0.427085217,9.77562576
,2.83107771,0.392018391,9.209769264
,2.848551282,0.366609902,8.875736802
,3.229977816,0.248268341,8.87202666
,3.5964441,0.279385661,8.55307413
,3.64551372,0.302232955,9.04077828
,3.639888666,0.371588674,10.21581616
,3.790089576,0.428832574,10.28307744
,3.78913212,0.535337586,10.08883355
,3.584236536,0.570392444,9.834509304
,3.304060974,0.489331825,9.658816128
,3.35827692,0.412484013,9.54104904
,3.255111036,0.373778854,9.391566222
,3.208913784,0.201987311,9.220420962
,3.324526596,0.279421565,9.485875638
,3.318662178,0.238981018,9.227960928
,3.293768322,0.130896203,9.371220282
,3.323808504,0.047103245,9.45966528
,3.341042712,0.018444193,9.542365542
,3.351814092,-0.02414345,9.56019816
,3.364380702,-0.088638883,9.618722658
,3.433796262,-0.21423078,9.586887246
,3.481788744,-0.290133104,9.473309028
,3.416203008,-0.328706613,9.491859738
,3.313515852,-0.34601263,9.464931288
,3.22722513,-0.354821225,9.407483928
,3.204365868,-0.360721548,9.574919046
,3.158886708,-0.389361451,9.505503486
,3.042555804,-0.322016389,9.515796138
,3.18054915,-0.369123224,9.455237046
,3.143567412,-0.419856424,9.621116298
,3.231174636,-0.465957931,9.536381442
,3.26372814,-0.511389218,9.527524974
,3.214179792,-0.56596421,9.484319772
,3.256666902,-0.568118486,9.528841476
,3.268395738,-0.538604905,9.58293774
,3.189764664,-0.492790635,9.818830962
,3.083247684,-0.408043811,9.714468258
,3.012276258,-0.359165682,9.604121454
,3.018020994,-0.355658999,9.4728303
,3.029869512,-0.425577224,9.519985008
,3.037050432,-0.409743295,9.505503486
,2.867221674,-0.319898018,9.523575468
,2.887687296,-0.336629561,9.584254242
,3.126811932,-0.441842008,9.661209768
,3.31040412,-0.537324307,9.777061944
,3.172650138,-0.425996111,9.87735546
,2.986783992,-0.394029049,9.421007994
,2.901929454,-0.341763919,9.464213196
,2.873684502,-0.288924316,9.703457514
,2.827846296,-0.365448987,9.460024326
,2.845678914,-0.351422257,9.770479434
,2.894628852,-0.412424172,9.653789484
,2.944057518,-0.417115706,9.687420126
,2.939270238,-0.406116931,9.645651108
,2.940706422,-0.407229973,9.641222874
,2.949682572,-0.453235734,9.514958364
,2.9800818,-0.470098928,9.575278092
,2.97349929,-0.512657847,9.48420009
,2.94776766,-0.459483134,9.594546894
,2.960214588,-0.425038655,9.53087607
,2.946690522,-0.394711236,9.544998546
,2.910426876,-0.364587277,9.516155184
,2.9142567,-0.308923178,9.577432368
,2.937235644,-0.268075712,9.63380259
,2.970866286,-0.251882737,9.654028848
,3.015866718,-0.259326958,9.673177968
,2.956504446,-0.224487527,9.659414538
,3.040999938,-0.225744188,9.614414106
,3.073912488,-0.267561079,9.616089654
,3.179831058,-0.28963044,9.645052698
,3.202211592,-0.342912866,9.708364476
,3.212384562,-0.317899328,9.61106301
,3.119631012,-0.293065313,9.575876502
,3.115801188,-0.266914796,9.669587508
,3.113646912,-0.240273583,9.618602976
,3.087316872,-0.24175764,9.62422803
,3.094138746,-0.249788302,9.609387462
,3.123341154,-0.295865872,9.625903578
,3.012515622,-0.268925454,9.564506712
,2.785718232,-0.213859766,9.528841476
,2.797447068,-0.19029438,9.443747574
,2.83825863,-0.199091007,9.359371764
,2.927780766,-0.247023648,9.685983942
,3.03154506,-0.260499841,9.7421148
,3.141413136,-0.304482976,9.692207406]]

    test = np.asarray(test)
    chann = (int(test.shape[1]/3))
    test = np.reshape(test,[chann,3])
    Ax = test[:,0]
    Ax = np.reshape(Ax,(-1,128))
    Ay = test[:,1]
    Ay = np.reshape(Ay,(-1,128))
    Az = test[:,2]
    Az = np.reshape(Az, (-1,128))

    
    data_test = np.hstack((Ax, Ay, Az))

    for i in range(num_channels):
        z = data_test[:, i * segment_size : (i + 1) * segment_size]
        data_test[:, i * segment_size : (i + 1) * segment_size] = norm(z)

    total_batch = int(test.shape[1])
    with tf.Session(graph=graph) as sess:
        for i in range(total_batch):
            
            batch_x = data_test[i,:]
            batch_x = norm(batch_x)
            batch_x = np.reshape(batch_x,(-1,384))
            
            y_out = sess.run(y_conv, feed_dict={
                x: batch_x, keep_prob:1})

            y_arg = np.argmax(y_out,1)
            y_out = y_out.T
            print("")
            print("probabilities : ")
            print("")
            print('Standing :        ', "%.2f" % (y_out[0,0]*100), '%')
            print('Standing_up :     ',"%.2f" % (y_out[1,0]*100), '%')
            print('Sitting :         ', "%.2f" % (y_out[2,0]*100), '%')
            print('Downstairs :      ', "%.2f" % (y_out[3,0]*100), '%')
            print('Upstairs :        ', "%.2f" % (y_out[4,0]*100), '%')
            print('Walking :         ', "%.2f" % (y_out[5,0]*100), '%')
            print("")
            
            if y_arg == 0:
                y_arg="Standing"
            if y_arg == 1:
                y_arg="Standing_up"
            if y_arg ==2:
                y_arg="Sitting"
            if y_arg==3:
                y_arg="Downstairs"
            if y_arg==4:
                y_arg="Upstairs"
            if y_arg==5:
                y_arg="Walking"
                
            print('predicted class :', y_arg)
            i += 1

